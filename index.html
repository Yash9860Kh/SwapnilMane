<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Official Portfolio & Live Analysis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --brand-purple: #2c2255;
            --brand-yellow: #ffc200;
            --positive-green: #00d09c; /* Vivid green for dark mode */
            --chart-green: #00b386;    /* Official green for light chart */
            --negative-red: #ff5252;
            --bg-gray: #f4f6f8;
            --card-white: #ffffff;
            --text-dark: #121212;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            padding: 0;
            color: var(--text-dark);
        }

        /* --- DASHBOARD STYLES --- */
        .live-ticker {
            background-color: var(--brand-purple);
            color: white;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .dashboard {
            max-width: 1000px;
            margin: 20px auto;
            padding: 0 15px;
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) { .dashboard { grid-template-columns: 1fr; } }

        .card {
            background: var(--card-white);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }

        .card-header {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            display: flex;
            justify-content: space-between;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .metric-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--brand-purple);
        }
        .metric-box.investment { border-left-color: var(--brand-yellow); }
        .metric-value { font-size: 24px; font-weight: 700; margin-top: 5px; }
        .metric-sub { font-size: 12px; margin-top: 4px; color: #666; }

        /* Ledger Table */
        .ledger-container { max-height: 300px; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; }
        .ledger-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .ledger-table th { position: sticky; top: 0; background: #eee; text-align: left; padding: 10px; font-weight: 600; }
        .ledger-table td { padding: 10px; border-bottom: 1px solid #f0f0f0; }
        .ledger-row-paid { background-color: #f0fffa; }

        /* Snapshot Card (Dark Blue) */
        .snapshot-card {
            background: linear-gradient(135deg, #242e47 0%, #1a1f2e 100%);
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
            overflow: hidden;
        }
        .snap-value { font-size: 36px; font-weight: 700; margin-bottom: 5px; }
        .snap-returns { font-size: 14px; color: var(--positive-green); font-weight: 600; }
        .snap-grid { display: flex; justify-content: space-between; margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 15px; }
        .snap-item span { display: block; font-size: 11px; opacity: 0.7; }
        .snap-item strong { font-size: 16px; }

        /* Interactive Button */
        .btn-analysis {
            display: block;
            margin-top: 15px;
            width: 100%;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            padding: 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            text-decoration: none;
            transition: background 0.2s;
        }
        .btn-analysis:hover { background: rgba(255,255,255,0.2); }

        /* --- MODAL (POPUP) STYLES --- */
        .modal-overlay {
            display: none; /* Hidden by default */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: white;
            width: 90%;
            max-width: 700px;
            border-radius: 12px;
            padding: 25px;
            position: relative;
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .close-btn {
            position: absolute; top: 15px; right: 20px;
            font-size: 24px; cursor: pointer; color: #666;
            background: none; border: none;
        }

        /* Styles specifically for the Analysis Modal (from first request) */
        .analysis-header h2 { font-size: 18px; margin: 0 0 5px 0; }
        .analysis-tags { color: #666; font-size: 12px; display: flex; gap: 10px; margin-bottom: 20px; }
        .analysis-price { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
        .analysis-change { font-size: 14px; font-weight: 600; color: var(--text-dark); margin-bottom: 20px; }
        
        .time-filters {
            display: flex; gap: 5px; margin-top: 20px; background: #f5f5f5; padding: 5px; border-radius: 30px;
        }
        .filter-btn {
            flex: 1; border: none; background: none; padding: 8px; border-radius: 20px;
            font-size: 13px; font-weight: 600; color: #666; cursor: pointer;
        }
        .filter-btn.active { background: #e0f2ec; color: #008060; }

    </style>
</head>
<body>

    <div class="live-ticker">
        <div><strong>LIVE MARKET:</strong> Motilal Oswal Midcap 150</div>
        <div id="tickerValue">NAV: â‚¹146.20 (+0.45%)</div>
    </div>

    <div class="dashboard">
        <div class="main-content">
            <div class="metrics-grid">
                <div class="metric-box investment">
                    <div class="metric-sub">TOTAL COMMITMENT (3 YRS)</div>
                    <div class="metric-value">â‚¹64,800</div>
                    <div class="metric-sub">Monthly SIP: â‚¹1,800</div>
                </div>
                <div class="metric-box">
                    <div class="metric-sub">CURRENTLY INVESTED</div>
                    <div class="metric-value">â‚¹3,600</div>
                    <div class="metric-sub">2 Months Completed</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <span>Growth Projection (3 Years)</span>
                </div>
                <div style="height: 250px;">
                    <canvas id="projectionChart"></canvas>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Monthly Investment Ledger</div>
                <div class="ledger-container">
                    <table class="ledger-table">
                        <thead><tr><th>#</th><th>Month</th><th>Amount</th><th>Total Invested</th></tr></thead>
                        <tbody id="ledgerBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="sidebar">
            <div class="snapshot-card">
                <div style="font-size:12px; opacity:0.8; margin-bottom:5px;">Current Portfolio Value</div>
                <div class="snap-value">â‚¹3,609</div>
                <div class="snap-returns">â–² â‚¹9 (0.26%)</div>
                
                <div class="snap-grid">
                    <div class="snap-item"><span>Invested</span><strong>â‚¹3,600</strong></div>
                    <div class="snap-item" style="text-align:right;"><span>XIRR</span><strong>0.26%</strong></div>
                </div>
                
                <button class="btn-analysis" onclick="openAnalysis()">
                    ðŸ“ˆ VIEW PORTFOLIO ANALYSIS
                </button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="analysisModal">
        <div class="modal-content">
            <button class="close-btn" onclick="closeAnalysis()">Ã—</button>
            
            <div class="analysis-header">
                <h2>Motilal Oswal Nifty Midcap 150 Index Fund</h2>
                <div class="analysis-tags">
                    <span>Moderately High Risk</span> â€¢ <span>Equity</span> â€¢ <span>Mid Cap</span>
                </div>
            </div>

            <div id="modalPriceDisplay">
                <div class="analysis-price">24.81% <span style="font-size:14px; color:#666; font-weight:400;">annualized</span></div>
                <div class="analysis-change">+0.82% 1D</div>
            </div>

            <div style="height: 300px; width: 100%; position: relative;">
                <canvas id="liveMarketChart"></canvas>
            </div>

            <div class="time-filters">
                <button class="filter-btn" onclick="updateLiveChart('1D')">1D</button>
                <button class="filter-btn" onclick="updateLiveChart('1M')">1M</button>
                <button class="filter-btn" onclick="updateLiveChart('6M')">6M</button>
                <button class="filter-btn" onclick="updateLiveChart('1Y')">1Y</button>
                <button class="filter-btn active" onclick="updateLiveChart('ALL')">ALL</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA & SETUP ---
        const monthlyAmount = 1800;
        const totalMonths = 36;
        const completedMonths = 2;

        // 1. Populate Ledger
        const ledgerBody = document.getElementById('ledgerBody');
        let cumulative = 0;
        let date = new Date();
        date.setMonth(date.getMonth() - completedMonths);

        for(let i=1; i<=totalMonths; i++) {
            cumulative += monthlyAmount;
            date.setMonth(date.getMonth() + 1);
            let monthName = date.toLocaleDateString('en-IN', {month:'short', year:'2-digit'});
            let row = document.createElement('tr');
            if(i <= completedMonths) row.classList.add('ledger-row-paid');
            row.innerHTML = `<td>${i}</td><td>${monthName}</td><td>â‚¹${monthlyAmount}</td><td><strong>â‚¹${cumulative.toLocaleString()}</strong></td>`;
            ledgerBody.appendChild(row);
        }

        // 2. Projection Chart (Main Dashboard)
        const ctxProj = document.getElementById('projectionChart').getContext('2d');
        const projData = {
            labels: Array.from({length:37}, (_, i) => i),
            datasets: [
                {
                    label: 'Market Value',
                    data: Array.from({length:37}, (_, i) => (i === 0 ? 0 : (i*monthlyAmount)*1.2)), // Fake growth
                    borderColor: '#00d09c', backgroundColor: 'rgba(0, 208, 156, 0.1)', fill: true, pointRadius: 0
                },
                {
                    label: 'Invested',
                    data: Array.from({length:37}, (_, i) => i*monthlyAmount),
                    borderColor: '#3f51b5', borderDash:[5,5], fill: false, pointRadius: 0
                }
            ]
        };
        new Chart(ctxProj, { type: 'line', data: projData, options: { responsive: true, maintainAspectRatio: false } });


        // --- 3. LIVE ANALYSIS LOGIC (POPUP) ---
        const modal = document.getElementById('analysisModal');
        let liveChartInstance = null;
        
        function openAnalysis() {
            modal.style.display = 'flex';
            // Wait for modal to render before drawing chart
            setTimeout(() => {
                if(!liveChartInstance) initLiveChart();
                updateLiveChart('ALL'); // Default view
            }, 100);
        }

        function closeAnalysis() {
            modal.style.display = 'none';
        }

        // Function to create random market data
        function generateMarketData(points, volatility, trend) {
            let data = [];
            let val = 100;
            for (let i = 0; i < points; i++) {
                val += (Math.random() - 0.45) * volatility + trend;
                data.push(val);
            }
            return data;
        }

        function initLiveChart() {
            const ctxLive = document.getElementById('liveMarketChart').getContext('2d');
            liveChartInstance = new Chart(ctxLive, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'NAV',
                        data: [],
                        borderColor: '#00b386',
                        borderWidth: 2,
                        tension: 0.1,
                        pointRadius: 0,
                        pointHoverRadius: 6,
                        pointHoverBackgroundColor: '#00b386',
                        pointHoverBorderColor: '#fff',
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { mode: 'index', intersect: false },
                    plugins: { legend: { display: false }, tooltip: { enabled: true, backgroundColor: '#000' } },
                    scales: { x: { display: false }, y: { display: false } },
                    animation: { duration: 1000 }
                }
            });
        }

        function updateLiveChart(timeframe) {
            // UI Button Logic
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            // Data Logic
            let points, vol, trend, labels;
            const displayDiv = document.getElementById('modalPriceDisplay');

            if (timeframe === '1D') {
                points = 40; vol = 0.5; trend = 0.1;
                labels = Array.from({length:40}, (_, i) => "9:" + (15+i));
                displayDiv.innerHTML = '<div class="analysis-price">â‚¹146.80 <span style="font-size:14px;color:#666">NAV</span></div><div class="analysis-change" style="color:#00d09c">+0.82% Today</div>';
                liveChartInstance.options.scales.x.display = true; // Show time for 1D
            } else {
                points = 100; vol = 2; trend = 0.4;
                labels = Array.from({length:100}, (_, i) => i);
                displayDiv.innerHTML = '<div class="analysis-price">24.81% <span style="font-size:14px;color:#666">annualized</span></div><div class="analysis-change">+12.4% Overall</div>';
                liveChartInstance.options.scales.x.display = false;
            }

            // Update Chart
            liveChartInstance.data.labels = labels;
            liveChartInstance.data.datasets[0].data = generateMarketData(points, vol, trend);
            liveChartInstance.update();
        }

        // Live Ticker Animation
        setInterval(() => {
            let r = (Math.random()*0.4 - 0.15).toFixed(2);
            document.getElementById('tickerValue').innerHTML = `NAV: â‚¹${(146.20+parseFloat(r)).toFixed(2)} (${r>0?'+':''}${r}%)`;
        }, 3000);

    </script>
</body>
</html>